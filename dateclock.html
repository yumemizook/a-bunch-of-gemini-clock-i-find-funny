<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Calendar Dial</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            margin: 0;
            background-color: #020617;
            overflow-x: hidden;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICON DEFINITIONS ---
        const Icon = ({ path, className, ...props }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
                className={className} {...props}
            >
                {path}
            </svg>
        );

        const Icons = {
            Clock: (props) => <Icon path={<><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></>} {...props} />,
            Calendar: (props) => <Icon path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></>} {...props} />,
            Info: (props) => <Icon path={<><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></>} {...props} />,
            MapPin: (props) => <Icon path={<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></>} {...props} />,
        };

        const DateClock = () => {
            const [date, setDate] = useState(new Date());
            const [showExplanation, setShowExplanation] = useState(false);
            const [weatherData, setWeatherData] = useState(null);
            const [location, setLocation] = useState({ lat: 51.5074, lng: -0.1278, name: "London" });
            const [locationError, setLocationError] = useState(null);

            useEffect(() => {
                const timer = setInterval(() => setDate(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            setLocation({
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                name: "My Location"
                            });
                            setLocationError(null);
                        },
                        (error) => {
                            console.warn("Geolocation blocked:", error);
                            setLocationError("GPS blocked. Using London.");
                        }
                    );
                }
            }, []);

            useEffect(() => {
                const fetchWeather = async () => {
                    try {
                        const response = await fetch(
                            `https://api.open-meteo.com/v1/forecast?latitude=${location.lat}&longitude=${location.lng}&current=temperature_2m,weather_code&timezone=auto`
                        );
                        const data = await response.json();
                        setWeatherData(data);
                    } catch (error) {
                        console.error("Failed to fetch weather:", error);
                    }
                };
                fetchWeather();
            }, [location]);

            const timeString = date.toLocaleTimeString('en-US', { hour12: false });
            const [hours, minutes, seconds] = timeString.split(':');
            const currentMonth = date.getMonth() + 1;
            const currentDay = date.getDate();

            const getWeekNumber = (d) => {
                const startOfYear = new Date(d.getFullYear(), 0, 1);
                const pastDays = (d - startOfYear) / 86400000;
                return Math.ceil((pastDays + startOfYear.getDay() + 1) / 7);
            };
            const currentWeek = getWeekNumber(date);
            const currentTemp = weatherData?.current?.temperature_2m || 0;
            const weatherCode = weatherData?.current?.weather_code;

            const daysInMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            const monthFraction = currentDay / daysInMonth;
            const monthAngle = ((currentMonth - 1) + monthFraction) * 30;
            const dayAngle = currentDay * 6;
            const weekFraction = date.getDay() / 7;
            const weekAngle = (currentWeek + weekFraction) * 6;
            const tempAngle = currentTemp * 6;

            // Calculate Weather Condition Angle (0-360) based on WMO codes
            // Mapping:
            // 12 o'clock (0 deg) -> Clear (0-1)
            // 2 o'clock (60 deg) -> Clouds (2-3)
            // 4 o'clock (120 deg) -> Fog (45-48)
            // 6 o'clock (180 deg) -> Rain (51-67, 80-82)
            // 8 o'clock (240 deg) -> Snow (71-77, 85-86)
            // 10 o'clock (300 deg) -> Thunder (95-99)
            const getConditionAngle = (code) => {
                if (code === undefined) return 0;
                if (code <= 1) return 0;
                if (code <= 3) return 60;
                if (code >= 45 && code <= 48) return 120;
                if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) return 180;
                if ((code >= 71 && code <= 77) || (code >= 85 && code <= 86)) return 240;
                if (code >= 95) return 300;
                return 0; // Default to clear
            };
            const conditionAngle = getConditionAngle(weatherCode);

            const weatherLabels = {
                0: 'CLEAR',
                10: 'CLOUD',
                20: 'FOG',
                30: 'RAIN',
                40: 'SNOW',
                50: 'STORM'
            };

            const renderTicks = () => {
                return Array.from({ length: 60 }).map((_, i) => {
                    const isHour = i % 5 === 0;
                    const angle = i * 6;
                    const isDayActive = i > 0 && i <= 31;
                    const weatherLabel = weatherLabels[i];

                    return (
                        <div key={i} className={`absolute left-1/2 top-0 h-[50%] origin-bottom ${isHour ? 'w-1' : 'w-0.5'} flex flex-col justify-start items-center`} style={{ transform: `translateX(-50%) rotate(${angle}deg)` }}>
                            <div className={`mt-1 rounded-full transition-colors duration-500 ${isHour ? 'h-4 sm:h-6' : 'h-2 sm:h-3'} ${i === currentDay ? 'bg-emerald-400 shadow-[0_0_10px_currentColor]' : (isDayActive ? 'bg-slate-700' : 'bg-slate-800')}`} />

                            {/* Standard Hours */}
                            {isHour && !weatherLabel && <div className="mt-2 text-lg sm:text-xl font-bold text-slate-600" style={{ transform: `rotate(-${angle}deg)` }}>{i === 0 ? 12 : i / 5}</div>}

                            {/* Weather Labels replacing hours at specific spots */}
                            {weatherLabel && (
                                <div className="mt-2 sm:mt-3 text-[8px] sm:text-[9px] font-black text-violet-500/50 tracking-widest" style={{ transform: `rotate(-${angle}deg)` }}>
                                    {weatherLabel}
                                </div>
                            )}

                            {/* Small Day Numbers */}
                            {i % 2 === 0 && i > 0 && i <= 31 && !isHour && <div className="mt-4 sm:mt-8 text-[8px] sm:text-[10px] text-slate-700 font-mono" style={{ transform: `rotate(-${angle}deg)` }}>{i}</div>}
                        </div>
                    );
                });
            };

            return (
                <div className="min-h-screen bg-slate-950 flex flex-col items-center py-8 px-4 text-slate-200 font-sans overflow-x-hidden selection:bg-emerald-500/30">
                    <div className="text-center space-y-4 mb-8 sm:mb-12 z-10 w-full max-w-lg mx-auto">
                        <h1 className="text-2xl sm:text-3xl font-light tracking-[0.2em] text-slate-400 uppercase break-words">The Calendar Dial</h1>
                        <div className="flex flex-wrap justify-center gap-x-6 gap-y-2 text-xs sm:text-sm font-medium tracking-widest text-slate-600">
                            <span className="flex items-center gap-2 whitespace-nowrap"><div className="w-3 h-1 bg-amber-500 rounded-full"></div> Month</span>
                            <span className="flex items-center gap-2 whitespace-nowrap"><div className="w-3 h-1 bg-emerald-500 rounded-full"></div> Day</span>
                            <span className="flex items-center gap-2 whitespace-nowrap"><div className="w-3 h-1 bg-rose-500 rounded-full"></div> Week</span>
                            <span className="flex items-center gap-2 whitespace-nowrap"><div className="w-3 h-1 bg-cyan-400 rounded-full"></div> Temp</span>
                            <span className="flex items-center gap-2 whitespace-nowrap"><div className="w-3 h-1 bg-violet-500 rounded-full"></div> Cond</span>
                        </div>
                    </div>

                    <div className="relative flex-shrink-0 w-[300px] h-[300px] sm:w-[500px] sm:h-[500px] flex items-center justify-center">
                        <div className="absolute inset-0 rounded-full border-4 border-slate-800 bg-slate-900/50 shadow-2xl backdrop-blur-sm"></div>
                        <div className="absolute inset-4 rounded-full border border-slate-800/50"></div>
                        <div className="absolute inset-4 sm:inset-8 rounded-full pointer-events-none">{renderTicks()}</div>

                        {/* Month Hand */}
                        <div className="absolute inset-0 flex justify-center items-center z-20 transition-transform duration-1000 cubic-bezier(0.4, 2, 0.55, 0.44)" style={{ transform: `rotate(${monthAngle}deg)` }}>
                            <div className="w-1.5 h-24 sm:h-40 bg-amber-500 rounded-full origin-bottom -translate-y-1/2 shadow-[0_0_15px_rgba(245,158,11,0.5)]"></div>
                            <div className="absolute w-1.5 h-6 sm:h-8 bg-amber-900/50 translate-y-3 sm:translate-y-4 rounded-full"></div>
                        </div>
                        {/* Day Hand */}
                        <div className="absolute inset-0 flex justify-center items-center z-30 transition-transform duration-1000 cubic-bezier(0.4, 2, 0.55, 0.44)" style={{ transform: `rotate(${dayAngle}deg)` }}>
                            <div className="w-1 h-32 sm:h-52 bg-emerald-500 rounded-full origin-bottom -translate-y-1/2 shadow-[0_0_15px_rgba(16,185,129,0.5)]"></div>
                            <div className="absolute w-3 h-3 bg-emerald-400 rounded-full"></div>
                        </div>
                        {/* Week Hand */}
                        <div className="absolute inset-0 flex justify-center items-center z-40" style={{ transform: `rotate(${weekAngle}deg)` }}>
                            <div className="w-0.5 h-36 sm:h-60 bg-rose-500 rounded-full origin-bottom -translate-y-1/2"></div>
                            <div className="absolute w-2 h-2 bg-rose-500 rounded-full"></div>
                            <div className="absolute w-0.5 h-8 sm:h-10 bg-rose-500 translate-y-4 sm:translate-y-5"></div>
                        </div>
                        {/* Temp Hand (Needle) */}
                        <div className="absolute inset-0 flex justify-center items-center z-35 transition-transform duration-1000 ease-out" style={{ transform: `rotate(${tempAngle}deg)` }}>
                            <div className="w-[1px] h-36 sm:h-56 bg-cyan-400 rounded-full origin-bottom -translate-y-1/2 shadow-[0_0_8px_rgba(34,211,238,0.8)] opacity-80"></div>
                            <div className="absolute w-2 h-2 border border-cyan-400 bg-slate-900 rounded-full -translate-y-[70px] sm:-translate-y-[110px]"></div>
                        </div>
                        {/* Weather Condition Hand (Dashed/Pointer) */}
                        <div className="absolute inset-0 flex justify-center items-center z-35 transition-transform duration-1000 ease-out" style={{ transform: `rotate(${conditionAngle}deg)` }}>
                            <div className="w-0.5 h-20 sm:h-32 bg-violet-500/50 rounded-full origin-bottom -translate-y-1/2 border-l border-dashed border-violet-300"></div>
                            <div className="absolute w-3 h-3 bg-violet-500 rounded-full -translate-y-[40px] sm:-translate-y-[64px] shadow-[0_0_10px_rgba(139,92,246,0.8)]"></div>
                        </div>

                        <div className="absolute z-50 flex flex-col items-center justify-center bg-slate-950 border border-slate-800 rounded-full w-28 h-28 sm:w-40 sm:h-40 shadow-[0_10px_40px_rgba(0,0,0,0.5)]">
                            <span className="text-[10px] sm:text-xs text-slate-500 uppercase tracking-widest mb-1 font-bold">Time</span>
                            <div className="text-2xl sm:text-4xl font-mono font-bold text-white tracking-tighter flex items-center">
                                <span>{hours}</span><span className="animate-pulse text-slate-600">:</span><span>{minutes}</span>
                            </div>
                            <div className="text-xs sm:text-sm font-mono text-slate-600 mt-1">{seconds}</div>
                            <div className="mt-2 flex items-center gap-1.5 px-2 py-0.5 bg-slate-900 rounded text-[9px] sm:text-[10px] text-slate-400 border border-slate-800 max-w-[90%]">
                                <Icons.MapPin className="text-cyan-500" size={10} /><span className="truncate max-w-[80px]">{location.name}</span>
                            </div>
                            <div className="text-[9px] text-cyan-400 mt-0.5 font-mono">{Math.round(currentTemp)}°C</div>
                        </div>
                    </div>

                    <div className="fixed bottom-6 right-6 z-50">
                        <button onClick={() => setShowExplanation(!showExplanation)} className="bg-slate-900/80 hover:bg-slate-800 text-slate-400 p-3 rounded-full border border-slate-700 transition-colors shadow-lg backdrop-blur-sm">
                            <Icons.Info size={24} />
                        </button>
                    </div>

                    {showExplanation && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
                            <div className="bg-slate-900 border border-slate-700 p-6 rounded-2xl max-w-md w-full shadow-2xl relative">
                                <button onClick={() => setShowExplanation(false)} className="absolute top-4 right-4 text-slate-500 hover:text-white">✕</button>
                                <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><Icons.Calendar className="text-emerald-500" />How to read the Dial</h2>
                                <div className="space-y-4 text-sm text-slate-300">
                                    <p>This dial uses standard clock geometry to display the current date and weather.</p>
                                    <div className="flex items-start gap-3"><div className="w-1 h-8 bg-amber-500 rounded shrink-0 mt-1"></div><div><strong className="text-amber-400 block">The Month Hand (Short)</strong>Points to 1-12 like hours.</div></div>
                                    <div className="flex items-start gap-3"><div className="w-1 h-12 bg-emerald-500 rounded shrink-0"></div><div><strong className="text-emerald-400 block">The Day Hand (Long)</strong>Points to 1-31 on the minute track.</div></div>
                                    <div className="flex items-start gap-3"><div className="w-[1px] h-12 bg-cyan-400 rounded shrink-0 border-l border-cyan-400"></div><div><strong className="text-cyan-400 block">The Temp Hand (Cyan Needle)</strong>Points to the current Temp (1 tick = 1°C).</div></div>
                                    <div className="flex items-start gap-3"><div className="w-1 h-8 bg-violet-500 rounded shrink-0"></div><div><strong className="text-violet-400 block">The Condition Hand (Violet)</strong>Points to weather type (Clear=12, Rain=6, etc).</div></div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DateClock />);
    </script>
</body>

</html>