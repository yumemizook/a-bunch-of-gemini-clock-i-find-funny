<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos Calendar</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    boxShadow: {
                        'glow-indigo': '0 0 10px rgba(99, 102, 241, 0.5)',
                        'glow-emerald': '0 0 10px rgba(16, 185, 129, 0.5)',
                        'glow-rose': '0 0 10px rgba(244, 63, 94, 0.5)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            margin: 0;
            background-color: #020617;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICON DEFINITIONS (Replacing Lucide Imports) ---
        const Icon = ({ path, className, ...props }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
                className={className} {...props}
            >
                {path}
            </svg>
        );

        const Icons = {
            Clock: (props) => <Icon path={<><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></>} {...props} />,
            Calendar: (props) => <Icon path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></>} {...props} />,
            Info: (props) => <Icon path={<><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></>} {...props} />,
            MapPin: (props) => <Icon path={<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></>} {...props} />,
            Sun: (props) => <Icon path={<><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" /></>} {...props} />,
            Cloud: (props) => <Icon path={<path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5S6.5 15.963 6.5 19h11Z" />} {...props} />,
            CloudRain: (props) => <Icon path={<><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" /><path d="M16 14v6" /><path d="M8 14v6" /><path d="M12 16v6" /></>} {...props} />,
            Snowflake: (props) => <Icon path={<><line x1="2" x2="22" y1="12" y2="12" /><line x1="12" x2="12" y1="2" y2="22" /><path d="m20 20-4-4" /><path d="m4 4 4 4" /><path d="m4 20 4-4" /><path d="m20 4-4 4" /></>} {...props} />,
            Zap: (props) => <Icon path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />} {...props} />,
            CloudFog: (props) => <Icon path={<><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" /><path d="M16 17H7" /><path d="M17 21H9" /></>} {...props} />,
        };

        const ChronosCalendar = () => {
            const [date, setDate] = useState(new Date());
            const [showExplanation, setShowExplanation] = useState(false);
            const [weatherData, setWeatherData] = useState(null);
            const [location, setLocation] = useState({ lat: 51.5074, lng: -0.1278, name: "London (Default)" });
            const [locationError, setLocationError] = useState(null);

            useEffect(() => {
                const timer = setInterval(() => setDate(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            setLocation({
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                name: "My Location"
                            });
                            setLocationError(null);
                        },
                        (error) => {
                            console.warn("Geolocation blocked:", error);
                            setLocationError("GPS blocked. Using London.");
                        }
                    );
                }
            }, []);

            useEffect(() => {
                const fetchWeather = async () => {
                    try {
                        const response = await fetch(
                            `https://api.open-meteo.com/v1/forecast?latitude=${location.lat}&longitude=${location.lng}&daily=weather_code,temperature_2m_max,temperature_2m_min&current=temperature_2m,weather_code&timezone=auto`
                        );
                        const data = await response.json();
                        setWeatherData(data);
                    } catch (error) {
                        console.error("Failed to fetch weather:", error);
                    }
                };
                fetchWeather();
            }, [location]);

            const year = date.getFullYear();
            const month = date.getMonth();
            const currentDay = date.getDate();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayOfMonth = new Date(year, month, 1).getDay();

            const hours = date.getHours();
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();
            const displayHour = hours === 0 ? 12 : (hours > 12 ? hours - 12 : hours);

            const getActiveDays = (value, maxDays) => {
                if (value === 0) return [];
                if (value <= maxDays) return [value];
                return [maxDays, value - maxDays];
            };

            const activeHourDays = useMemo(() => [displayHour], [displayHour]);
            const activeMinuteDays = useMemo(() => getActiveDays(minutes, daysInMonth), [minutes, daysInMonth]);
            const activeSecondDays = useMemo(() => getActiveDays(seconds, daysInMonth), [seconds, daysInMonth]);

            const getWeatherForDay = (dayNumber, isToday) => {
                if (!weatherData || !weatherData.daily) return null;
                if (isToday && weatherData.current) {
                    return {
                        code: weatherData.current.weather_code,
                        current: Math.round(weatherData.current.temperature_2m),
                        isCurrent: true
                    };
                }
                const targetDate = new Date(year, month, dayNumber);
                const offset = targetDate.getTimezoneOffset();
                const localDate = new Date(targetDate.getTime() - (offset * 60 * 1000));
                const dateStr = localDate.toISOString().split('T')[0];
                const index = weatherData.daily.time.findIndex(t => t === dateStr);
                if (index !== -1) {
                    return {
                        code: weatherData.daily.weather_code[index],
                        max: Math.round(weatherData.daily.temperature_2m_max[index]),
                        min: Math.round(weatherData.daily.temperature_2m_min[index]),
                        isCurrent: false
                    };
                }
                return null;
            };

            const WeatherIcon = ({ code, className }) => {
                if (code === undefined) return <Icons.Sun className={className} />;
                if (code <= 1) return <Icons.Sun className={className} />;
                if (code <= 3) return <Icons.Cloud className={className} />;
                if (code >= 45 && code <= 48) return <Icons.CloudFog className={className} />;
                if (code >= 51 && code <= 67) return <Icons.CloudRain className={className} />;
                if (code >= 71 && code <= 77) return <Icons.Snowflake className={className} />;
                if (code >= 95) return <Icons.Zap className={className} />;
                return <Icons.Sun className={className} />;
            };

            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const weekDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

            const renderCalendarDays = () => {
                const blanks = Array(firstDayOfMonth).fill(null);
                const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
                const totalSlots = [...blanks, ...days];

                return totalSlots.map((day, index) => {
                    if (!day) return <div key={`blank-${index}`} className="h-24 bg-transparent" />;

                    const isHour = activeHourDays.includes(day);
                    const isMinute = activeMinuteDays.includes(day);
                    const isSecond = activeSecondDays.includes(day);
                    const isToday = day === currentDay;
                    const dayWeather = getWeatherForDay(day, isToday);

                    let cellStyle = "border-slate-800 bg-slate-900/40 text-slate-500";
                    let glowEffect = "";

                    if (isToday) cellStyle = "border-slate-600 bg-slate-800 text-slate-300 font-bold";
                    if (isHour) cellStyle = "border-indigo-500/50 bg-indigo-900/60 text-indigo-100 shadow-[inset_0_0_20px_rgba(79,70,229,0.4)]";
                    if (isMinute) cellStyle = isHour ? "border-emerald-400 bg-gradient-to-br from-indigo-900/80 to-emerald-900/80 text-white font-bold" : "border-emerald-500/60 bg-emerald-900/30 text-emerald-100";
                    if (isSecond) {
                        glowEffect = "animate-pulse shadow-[0_0_15px_rgba(244,63,94,0.6)] ring-1 ring-rose-500";
                        if (isMinute && isHour) cellStyle = "border-white bg-gradient-to-tr from-indigo-600 via-emerald-500 to-rose-500 text-white font-extrabold";
                        else if (isMinute) cellStyle = "border-rose-400 bg-gradient-to-b from-emerald-900/60 to-rose-900/60 text-white";
                        else if (isHour) cellStyle = "border-rose-400 bg-gradient-to-b from-indigo-900/60 to-rose-900/60 text-white";
                        else cellStyle = "border-rose-500 bg-rose-950/40 text-rose-200";
                    }

                    return (
                        <div key={day} className={`relative group h-20 sm:h-24 p-2 border transition-all duration-300 ease-out flex flex-col justify-between rounded-xl overflow-hidden ${cellStyle} ${glowEffect}`}>
                            <span className={`text-lg sm:text-2xl z-10 ${isToday ? 'underline decoration-2 decoration-slate-400 underline-offset-4' : ''}`}>{day}</span>
                            {dayWeather && (
                                <div className={`absolute bottom-2 left-2 flex items-center gap-1.5 opacity-70 group-hover:opacity-100 transition-opacity ${isSecond || isMinute ? 'opacity-100 text-white' : ''}`}>
                                    <WeatherIcon code={dayWeather.code} className="w-4 h-4" />
                                    <div className="flex flex-col leading-none">
                                        {dayWeather.isCurrent ? <span className="text-xs font-mono font-bold">{dayWeather.current}°</span> : <><span className="text-[10px] font-mono">{dayWeather.max}°</span><span className="text-[8px] font-mono opacity-70">{dayWeather.min}°</span></>}
                                    </div>
                                </div>
                            )}
                            <div className="absolute top-2 right-2 flex gap-1 z-10">
                                {isHour && <div className="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-indigo-400 shadow-glow-indigo" title="Hour"></div>}
                                {isMinute && <div className="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-emerald-400 shadow-glow-emerald" title="Minute"></div>}
                                {isSecond && <div className="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-rose-500 shadow-glow-rose" title="Second"></div>}
                            </div>
                        </div>
                    );
                });
            };

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 p-4 sm:p-8 font-sans selection:bg-rose-500/30">
                    <div className="max-w-4xl mx-auto space-y-6">
                        <header className="flex flex-col md:flex-row justify-between items-end md:items-center pb-6 border-b border-slate-800">
                            <div>
                                <h1 className="text-4xl sm:text-6xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-purple-400 to-rose-400">{monthNames[month]}</h1>
                                <p className="text-xl text-slate-500 font-light tracking-widest mt-1 ml-1">{year}</p>
                            </div>
                            <div className="text-right mt-4 md:mt-0">
                                <div className="text-3xl font-mono tabular-nums text-slate-100 flex items-center justify-end gap-3">
                                    <Icons.Clock className="w-6 h-6 text-slate-600" />
                                    {hours.toString().padStart(2, '0')}:{minutes.toString().padStart(2, '0')}:{seconds.toString().padStart(2, '0')}
                                </div>
                                <div className="text-xs text-slate-500 mt-1 uppercase tracking-widest flex items-center justify-end gap-2">
                                    <span>System Time</span>
                                    <span className="text-slate-700">•</span>
                                    <span className="flex items-center gap-1"><Icons.MapPin size={10} /> {location.name}</span>
                                </div>
                            </div>
                        </header>

                        <div className="flex flex-wrap gap-4 text-sm font-medium select-none">
                            <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-indigo-950/50 border border-indigo-900/50 text-indigo-300">
                                <div className="w-2 h-2 rounded-full bg-indigo-500"></div>Hour ({displayHour})
                            </div>
                            <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-emerald-950/50 border border-emerald-900/50 text-emerald-300">
                                <div className="w-2 h-2 rounded-full bg-emerald-500"></div>Minute ({minutes})
                            </div>
                            <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-rose-950/50 border border-rose-900/50 text-rose-300">
                                <div className="w-2 h-2 rounded-full bg-rose-500 animate-pulse"></div>Second ({seconds})
                            </div>
                            <button onClick={() => setShowExplanation(!showExplanation)} className="ml-auto flex items-center gap-1.5 text-slate-500 hover:text-slate-300 transition-colors text-xs">
                                <Icons.Info size={14} />How does this work?
                            </button>
                        </div>

                        {showExplanation && (
                            <div className="bg-slate-900/50 border border-slate-800 p-4 rounded-xl text-sm text-slate-400 animate-in fade-in slide-in-from-top-2">
                                <p className="mb-2"><strong className="text-slate-200">The "Split-Sum" Logic:</strong> Minutes (0-59) map to Days (1-31).</p>
                                <ul className="list-disc pl-5 space-y-1">
                                    <li>If value &le; 31, that day lights up.</li>
                                    <li>If value &gt; 31 (e.g., 45), it lights up the <strong>Last Day</strong> (31) + <strong>Remainder</strong> (14).</li>
                                </ul>
                            </div>
                        )}

                        <div className="bg-slate-950 rounded-3xl border border-slate-800/50 overflow-hidden shadow-2xl">
                            <div className="grid grid-cols-7 bg-slate-900/50 border-b border-slate-800">
                                {weekDays.map(d => <div key={d} className="py-3 text-center text-xs sm:text-sm font-bold text-slate-500 uppercase tracking-widest">{d}</div>)}
                            </div>
                            <div className="grid grid-cols-7 bg-slate-900/20">{renderCalendarDays()}</div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ChronosCalendar />);
    </script>
</body>

</html>